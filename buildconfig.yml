# Sample buildconfig.yml
# project_name: Required. The name of your Xcode project (without .xcodeproj). Used for all build commands.
project_name: CarManager
# exclude_from_globals: List of top-level keys that should NOT be propagated as global variables.
exclude_from_globals:
  - tasks
  - platforms
  - build_groups
  - logging
  - exclude_from_globals
  - name
  - args
  - command
  - type
  - dependencies
  - children
platforms:
  - name: macOS
    build_command: xcodebuild build -workspace .swiftpm/xcode/package.xcworkspace -scheme SixLayerFramework -destination "platform=macOS,arch=arm64"
    artifact_dir: build/macos
    artifact_patterns:
      - build/macos/*.app
    # scheme: Required. The Xcode scheme to build for this platform.
  - name: macOS_tests
    build_command: xcodebuild test -project SixLayerFramework.xcodeproj -scheme SixLayerFramework-AllTests-macOS -destination "platform=macOS,arch=arm64" -parallel-testing-enabled YES
    artifact_dir: build/macos
    artifact_patterns:
      - build/macos/*.app
    # scheme: Required. The Xcode scheme to build for this platform.
  - name: iOS_build
    build_command: xcodebuild build -workspace .swiftpm/xcode/package.xcworkspace -scheme SixLayerFramework   -destination "platform=iOS Simulator,name=iPhone 17 Pro Max"
    artifact_dir: build/ios
    artifact_patterns:
      - build/ios/*.ipa
    # scheme: Required. The Xcode scheme to build for this platform.
  - name: iOS_tests
    build_command: xcodebuild test -project SixLayerFramework.xcodeproj -scheme SixLayerFramework-AllTests-iOS -destination "platform=iOS Simulator,name=iPhone 17 Pro Max" -parallel-testing-enabled YES -maximum-concurrent-test-simulator-destinations 2
    artifact_dir: build/ios
    artifact_patterns:
      - build/ios/*.ipa
    # scheme: Required. The Xcode scheme to build for this platform.
  - name: tvOS_build
    build_command: xcodebuild build -workspace .swiftpm/xcode/package.xcworkspace -scheme SixLayerFramework -destination "platform=tvOS Simulator,name=Apple TV"
    artifact_dir: build/tvos
    artifact_patterns:
      - build/tvos/*.app
  - name: tvOS_tests
    build_command: xcodebuild test -project SixLayerFramework.xcodeproj -scheme SixLayerFramework-AllTests-tvOS -destination "platform=tvOS Simulator,name=Apple TV" -parallel-testing-enabled YES
    artifact_dir: build/tvos
    artifact_patterns:
      - build/tvos/*.app
  - name: watchOS_build
    build_command: xcodebuild build -workspace .swiftpm/xcode/package.xcworkspace -scheme SixLayerFramework -destination "platform=watchOS Simulator,name=Apple Watch Series 9 (45mm)"
    artifact_dir: build/watchos
    artifact_patterns:
      - build/watchos/*.app
  - name: watchOS_tests
    build_command: xcodebuild test -project SixLayerFramework.xcodeproj -scheme SixLayerFramework-AllTests-watchOS -destination "platform=watchOS Simulator,name=Apple Watch Series 9 (45mm)" -parallel-testing-enabled YES
    artifact_dir: build/watchos
    artifact_patterns:
      - build/watchos/*.app
  - name: visionOS_build
    build_command: xcodebuild build -workspace .swiftpm/xcode/package.xcworkspace -scheme SixLayerFramework -destination "platform=visionOS Simulator,name=Apple Vision Pro"
    artifact_dir: build/visionos
    artifact_patterns:
      - build/visionos/*.app
  - name: visionOS_tests
    build_command: xcodebuild test -project SixLayerFramework.xcodeproj -scheme SixLayerFramework-AllTests-visionOS -destination "platform=visionOS Simulator,name=Apple Vision Pro" -parallel-testing-enabled YES
    artifact_dir: build/visionos
    artifact_patterns:
      - build/visionos/*.app
tasks:
  - name: generate-file-list
    # Example: passing a secret as an environment variable (uncomment to use)
    # command: "MY_SECRET=foo ./myscript.sh $arg1"
    # command: "MY_SECRET=$arg1 ./myscript.sh $arg2"
    # command: "MY_SECRET=$(secret_key_program.sh) ./myscript.sh $arg2"
    command: ./Scripts/generate_file_list.py
    log_file: build/logs/generate-file-list.log
    always_run: false
    requires: []
  - name: xcodegen
    description: "Generates the Xcode project from project.yml and all project files. (uses cache)"
    command: "xcodegen -c"
    dependencies:
      - generate-file-list
    inputs:
      - project.yml
      - all_project_files.txt
  - name: commit-changes
    description: "Commit all changes with version message (optional platform argument)"
    command: "./Scripts/commit_and_tag.sh commit $arg1"
    args_optional: true
build_groups:
  all:
    continue_on_error: true
    parallel: false
    targets:
      - build
      - test
  build:
    continue_on_error: true
    parallel: true
    targets:
      - macOS
      - iOS_build
      - tvOS_build
      - watchOS_build
      - visionOS_build
  test:
    continue_on_error: true
    parallel: true
    targets:
      - macOS_tests
      - iOS_tests
      - tvOS_tests
      - watchOS_tests
      - visionOS_tests
  mac:
    targets:
      - xcodegen
      - macOS
      - macOS_tests
  macOS_tests:
    targets:
      - xcodegen
      - macOS_tests
  iOS:
    targets:
      - xcodegen
      - iOS_build
      - iOS_tests
  iOS_test:
    targets:
      - xcodegen
      - iOS_tests
  tvos:
    targets:
      - xcodegen
      - tvOS_build
      - tvOS_tests
  tvos_test:
    targets:
      - xcodegen
      - tvOS_tests
  watchos:
    targets:
      - xcodegen
      - watchOS_build
      - watchOS_tests
  watchos_test:
    targets:
      - xcodegen
      - watchOS_tests
  visionos:
    targets:
      - xcodegen
      - visionOS_build
      - visionOS_tests
  visionos_test:
    targets:
      - xcodegen
      - visionOS_tests