# XCUITest Tests for Accessibility Identifiers

These tests use **XCUITest** (Apple's UI testing framework) to verify that accessibility identifiers are actually usable by UI testing frameworks.

## Why XCUITest?

Using XCUITest directly provides the most realistic test because:
- It uses the actual `XCUIApplication` and `XCUIElement` APIs that real UI tests use
- It tests the full app lifecycle (app launch, view rendering, accessibility propagation)
- It verifies that identifiers are queryable the same way production UI tests would query them
- It's the gold standard for UI testing on Apple platforms

## Setup

### 1. Test App Target

The test app target (`SixLayerFrameworkTestApp`) is defined in `project.yml` and will be generated by xcodegen. This is a minimal app that displays views for testing.

### 2. UI Test Target (Manual Setup Required)

Since `xcodegen` doesn't support `bundle.ui-test` targets, you need to manually add the UI test target in Xcode:

1. **Open the project in Xcode**
2. **File → New → Target...**
3. **Select "UI Testing Bundle"** (under "Testing")
4. **Configure:**
   - Product Name: `SixLayerFrameworkUITests_macOS` (or `_iOS`)
   - Bundle Identifier: `com.sixlayer.framework.ui-tests`
   - Language: Swift
   - Target to be Tested: `SixLayerFrameworkTestApp_macOS` (or `_iOS`)
5. **Add the test files:**
   - Add `Development/Tests/SixLayerFrameworkUITests/AccessibilityXCUITests.swift` to the target
   - Make sure `TestApp/` directory is **excluded** from the UI test target (it's only for the app target)
6. **Configure the scheme:**
   - Edit the scheme
   - In the "Test" action, add the UI test target
   - Make sure the test app target is built before tests run

### 3. Alternative: Use Existing RealUITests with XCUITest APIs

If you prefer not to set up a separate UI test target, you can use the existing `RealUITests` but query using XCUITest-style APIs. However, this requires:
- An app to launch (which we now have with `TestApp`)
- Using `XCUIApplication` instead of programmatically creating windows

## Running Tests

Once the UI test target is set up:

```bash
# Run UI tests via xcodebuild
xcodebuild test \
  -project SixLayerFramework.xcodeproj \
  -scheme SixLayerFramework-AllTests-macOS \
  -destination "platform=macOS,arch=arm64" \
  -only-testing:SixLayerFrameworkUITests_macOS
```

Or in Xcode:
1. Select the `SixLayerFrameworkUITests_macOS` scheme
2. Product → Test (⌘U)

## Test Structure

- **TestApp/**: Minimal app that displays test views
- **Layer1–6, AccessibilityCompatibility, XCUITestHelpers**: XCUITest tests (navigate → sweep → asserts)
- **WindowRenderingTestHelper.swift**: Helper for programmatic window hosting (NSWindow/UIWindow + SwiftUI) when tests need to render views in real windows without launching the full TestApp. Used for future tests; current XCUITest tests launch TestApp.

## Key Differences from programmatic window tests

| Aspect | WindowRenderingTestHelper (programmatic) | XCUITest (this target) |
|--------|----------------------------------------|------------------------|
| **Framework** | Swift Testing + manual window creation | XCUITest (XCTest) |
| **App Lifecycle** | Programmatic window creation | Full app launch via `XCUIApplication` |
| **Element Queries** | Manual view hierarchy search | `XCUIElement` queries (same as production) |
| **Realism** | Good for testing rendering | Best for testing accessibility integration |

Both approaches are in this target: XCUITest tests launch TestApp; WindowRenderingTestHelper is available for programmatic window tests.
