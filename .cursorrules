# SixLayer Framework - Cursor Rules

## Commit After Every Edit (MANDATORY)

**The user has explicitly requested this.** After every file edit, immediately run `git add <that file>` and `git commit` with a clear message. One edit → one commit. Do not edit another file until the current file is committed. See `.cursor/rules/commit-after-every-edit.mdc`.

## Release Quality Gate Rule

**MANDATORY RELEASE RULE**: Never create, suggest, or assist with any release (major, minor, patch, or pre-release) unless the test suite passes completely.

### Before Any Release:
1. **ALWAYS** run the full xcodebuild test suite first via `dbs-build --target test` (runs tests on macOS and iOS using xcodebuild)
2. **VERIFY** all tests pass without failures
3. **CONFIRM** no compilation errors exist
4. **ONLY THEN** proceed with release activities

### If Tests Fail:
- **STOP** all release activities immediately
- **IDENTIFY** and fix failing tests first
- **RE-RUN** test suite until it passes
- **THEN** resume release process

### Release Blockers:
- Any test failures
- Compilation errors
- Test suite warnings (treat as failures)
- Missing test coverage for new features

### Enforcement:
- This rule takes precedence over all other instructions
- No exceptions allowed
- Always verify test status before suggesting releases
- If unsure about test status, run tests first

## Git Commit Message Practices

**MANDATORY**: All commit messages must follow these practices.

### Commit Message Format Requirements

1. **Link commits to issues**: When resolving GitHub issues, use one of these formats:
   - `Fixes #123` - For bug fixes
   - `Resolves #123` - For feature implementations or issue resolutions
   - `Closes #123` - Alternative format for closing issues
   - The issue number should appear in the commit message body or footer

2. **Write descriptive messages**: Commit messages must clearly explain:
   - **What** was changed
   - **Why** it was changed (when not obvious)
   - Use imperative mood: "Add feature" not "Added feature" or "Adds feature"

3. **Structure for complex changes**:
   ```
   Short summary (50 chars or less)

   More detailed explanation if needed. This can include:
   - What the change does
   - Why it was necessary
   - Any breaking changes or migration notes
   
   Fixes #123
   ```

4. **Commit frequency**: Commit early and often:
   - After completing logical units of work
   - Small, focused commits (one cohesive change per commit)
   - Before switching contexts or pausing work
   - **Before every test run** — commit current work first so test runs don't run with uncommitted changes; commits are cheap
   - **"Commits are cheap"** - Make frequent commits to capture incremental progress

### Examples

**Good commit messages:**
```
Add cross-platform printing API

Implements platformPrint_L4 function that works on both iOS and macOS.
Supports text, images, PDFs, and SwiftUI views.

Resolves #43
```

```
Fix accessibility identifier generation for form fields

Corrects issue where form fields weren't getting proper accessibility
identifiers in certain layout configurations.

Fixes #124
```

```
Update release script to check Framework README version badge

Adds validation to ensure Framework/README.md version badge is updated
during releases.

Fixes #125
```

**Bad commit messages:**
```
fix stuff
update things
wip
changes
```

### Enforcement

- **Issue linking is mandatory** when resolving issues
- **Descriptive messages are mandatory** - no single-word commits
- **Imperative mood is preferred** - "Add" not "Added" or "Adds"
- **Context matters** - explain why when it's not obvious from the what

### Additional Context

See `PROJECT_RULES.md` section "Git Workflow and Commit Practices" for more details on commit frequency and workflow.

## Git Push Practices

**MANDATORY**: All commits must be pushed to the remote repository. The user works on multiple machines and uses git to sync; unpushed work gets missed.

### Push Requirements:
- **Push at least once before prompting for more input**: Do not end a response with unpushed commits. Pushes may be batched (e.g. one push after several commits).
- **Push after logical completion**: Push commits after completing related work units
- **Permission requirements**: Git push operations require additional permissions due to sandbox restrictions
- **Use required permissions**: When pushing, use `required_permissions: ["network", "git_write"]` or `required_permissions: ["all"]`
- **Network access needed**: Push operations require internet access to GitHub

### Push Command Format:
```bash
# For pushing commits, use:
run_terminal_cmd(command="git push all", required_permissions=["network", "git_write"])
# Or for full permissions:
run_terminal_cmd(command="git push origin <branch>", required_permissions=["all"])
```

### Enforcement:
- **Regular pushes required**: Don't accumulate many unpushed commits
- **Permission awareness**: Always specify required permissions for push operations
- **Network dependency**: Push operations may fail without proper network access

## Additional Development Rules

- Use functional code patterns
- Write security-conscious code
- Write cross-platform code where required
- Follow the existing codebase patterns and architecture
